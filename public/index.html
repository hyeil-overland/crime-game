<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í¬ë¼ì„ì”¬: ì €íƒ ì‚´ì¸ ì‚¬ê±´</title>
    <style>
        body { background-color: #0a0a0a; color: #d4af37; font-family: 'Apple SD Gothic Neo', sans-serif; margin: 0; }
        
        /* ë©”ì¸ ì„¤ì • í™”ë©´ */
        #setup-screen {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100vh; text-align: center;
        }
        .container { border: 2px solid #333; padding: 50px; background: #1a1a1a; }
        input { padding: 15px; width: 250px; background: #222; border: 1px solid #444; color: white; margin-bottom: 20px; }
        button { padding: 15px 40px; background-color: #800000; color: white; border: none; cursor: pointer; }

        /* ê²Œì„ í™”ë©´ (ì²˜ìŒì—” ìˆ¨ê¹€) */
        #game-screen { display: none; padding: 20px; }
        .main-layout { display: flex; gap: 20px; justify-content: center; }
        
        #scene-container { position: relative; width: 800px; height: 600px; border: 3px solid #555; }
        #background-img { width: 100%; height: 100%; object-fit: cover; }
        
        /* í´ë¦­ ìŠ¤íŒŸ */
        .click-spot { position: absolute; background-color: rgba(255, 0, 0, 0); cursor: pointer; }
        #spot-sofa { top: 400px; left: 150px; width: 200px; height: 100px; }

        /* ì‚¬ì´ë“œë°” (ì ‘ì†ì & ì±„íŒ…) */
        .sidebar { width: 300px; display: flex; flex-direction: column; gap: 20px; }
        .info-box { background: #1a1a1a; border: 1px solid #444; padding: 15px; height: 200px; overflow-y: auto; }
        #chat-box { background: #1a1a1a; border: 1px solid #444; padding: 15px; height: 355px; overflow-y: auto; color: white; font-size: 0.9rem; }
        
        .clue-img { width: 80px; margin-top: 5px; border: 1px solid #d4af37; }
        .system-msg { color: #888; font-style: italic; }
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 5px; color: #00ff00; } /* ì ‘ì†ìëŠ” ì´ˆë¡ìƒ‰ í‘œì‹œ */
    </style>
</head>
<body>

    <div id="setup-screen">
        <div class="container">
            <h1>í¬ë¼ì„ì”¬: ì €íƒ ì‚´ì¸ ì‚¬ê±´</h1>
            <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <br>
            <button onclick="joinGame()">í˜„ì¥ ì…ì¥í•˜ê¸°</button>
        </div>
    </div>

    <div id="game-screen">
        <h2 style="text-align: center;">ğŸ” ì‚¬ê±´ í˜„ì¥ ìˆ˜ìƒ‰</h2>
        <div class="main-layout">
            <div id="scene-container">
                <img id="background-img" src="/images/room_bg.jpg">
                <div id="spot-sofa" class="click-spot" onclick="findClue('ë°”ë‹¥ì˜ í˜ˆí”', 'https://via.placeholder.com/100')"></div>
            </div>

            <div class="sidebar">
                <div class="info-box">
                    <h3>ğŸ‘¥ í˜„ì¬ ì ‘ì†ì</h3>
                    <ul id="playerList"></ul>
                </div>
                <div id="chat-box">
                    <div class="system-msg">ë‹¨ì„œë¥¼ ì°¾ì•„ í´ë¦­í•˜ì„¸ìš”...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myName = "";

        // ê²Œì„ ì…ì¥ í•¨ìˆ˜
        function joinGame() {
            const input = document.getElementById('nicknameInput');
            if (input.value.trim() !== "") {
                myName = input.value;
                socket.emit('join', myName); // ì„œë²„ì— ì ‘ì† ì•Œë¦¼

                // í™”ë©´ ì „í™˜
                document.getElementById('setup-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
            } else {
                alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            }
        }

        // ì ‘ì†ì ëª…ë‹¨ ì—…ë°ì´íŠ¸ ë°›ê¸°
        socket.on('updatePlayerList', (players) => {
            const listElement = document.getElementById('playerList');
            listElement.innerHTML = "";
            players.forEach(name => {
                const li = document.createElement('li');
                li.innerText = `â— ${name} ${name === myName ? '(ë‚˜)' : ''}`;
                listElement.appendChild(li);
            });
        });

        // ë‹¨ì„œ ì°¾ê¸° í•¨ìˆ˜
        function findClue(clueName, imgPath) {
            socket.emit('clueFound', { playerName: myName, clue: clueName, image: imgPath });
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ ë°›ê¸° (ì‹œìŠ¤í…œ ë©”ì‹œì§€ í¬í•¨)
        socket.on('chatAnnounce', (data) => {
            const chatBox = document.getElementById('chat-box');
            const msg = document.createElement('div');
            msg.style.marginBottom = "10px";

            if (data.system) {
                msg.innerHTML = `<span class="system-msg">[ì•Œë¦¼] ${data.text}</span>`;
            } else {
                msg.innerHTML = `<strong>${data.playerName}</strong>: [${data.clue}] ë°œê²¬!<br><img src="${data.image}" class="clue-img">`;
            }
            
            chatBox.appendChild(msg);
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    </script>
</body>
</html>